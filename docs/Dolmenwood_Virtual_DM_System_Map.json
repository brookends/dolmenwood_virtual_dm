{
  "project": {
    "name": "Dolmenwood Virtual DM",
    "version": "0.1.0",
    "language": "Python",
    "python_version": "^3.11",
    "package_manager": "poetry",
    "root_package": "src",
    "repo_stats": {
      "python_files_total": 162,
      "python_files_src": 116,
      "python_files_tests": 46,
      "tests_passed": 1972,
      "tests_skipped": 1
    },
    "entrypoints": [
      {
        "type": "cli",
        "module": "src.main",
        "function": "main",
        "notes": "Runs demo session / CLI flags. Primary runtime entrypoint in this repo."
      },
      {
        "type": "conversation",
        "module": "src.conversation.conversation_facade",
        "class": "ConversationFacade",
        "notes": "Chat-first wrapper producing TurnResponse + suggested actions."
      }
    ]
  },
  "architecture": {
    "core_concepts": {
      "authoritative_mechanics": "All mechanical outcomes resolved in Python engines; LLM (DMAgent) is advisory narration only.",
      "global_controller": "Central mutable game state fa√ßade; engines mutate through it.",
      "state_machine": "Finite game-state machine gating which procedures/actions are legal.",
      "immutable_content_plus_session_deltas": "SessionManager persists only deltas from base content definitions (hex/POI/NPC)."
    },
    "packages": [
      {
        "id": "advancement",
        "file_count": 2,
        "modules": [
          {
            "path": "advancement/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.advancement.xp_manager"
            ]
          },
          {
            "path": "advancement/xp_manager.py",
            "classes": [
              "XPAwardType",
              "MilestoneType",
              "ExplorationGoal",
              "XPAwardResult",
              "LevelUpResult",
              "XPManager"
            ],
            "functions": [
              "get_milestone_award"
            ],
            "imports": []
          }
        ]
      },
      {
        "id": "ai",
        "file_count": 5,
        "modules": [
          {
            "path": "ai/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.ai.dm_agent",
              "src.ai.llm_provider",
              "src.ai.lore_search",
              "src.ai.prompt_schemas"
            ]
          },
          {
            "path": "ai/dm_agent.py",
            "classes": [
              "DMAgentConfig",
              "DescriptionResult",
              "DMAgent"
            ],
            "functions": [
              "get_dm_agent",
              "reset_dm_agent"
            ],
            "imports": [
              "src.ai.llm_provider",
              "src.ai.lore_search",
              "src.ai.prompt_schemas",
              "src.data_models"
            ]
          },
          {
            "path": "ai/llm_provider.py",
            "classes": [
              "LLMProvider",
              "LLMRole",
              "LLMMessage",
              "LLMResponse",
              "LLMConfig",
              "BaseLLMClient",
              "AnthropicClient",
              "OpenAIClient",
              "MockLLMClient",
              "LLMManager"
            ],
            "functions": [
              "get_llm_manager"
            ],
            "imports": []
          },
          {
            "path": "ai/lore_search.py",
            "classes": [
              "LoreCategory",
              "LoreSearchResult",
              "LoreSearchQuery",
              "LoreSearchInterface",
              "NullLoreSearch",
              "VectorLoreSearch",
              "MockLoreSearch"
            ],
            "functions": [
              "create_lore_search"
            ],
            "imports": []
          },
          {
            "path": "ai/prompt_schemas.py",
            "classes": [
              "PromptSchemaType",
              "PromptSchema",
              "ExplorationDescriptionInputs",
              "ExplorationDescriptionOutput",
              "ExplorationDescriptionSchema",
              "EncounterFramingInputs",
              "EncounterFramingOutput",
              "EncounterFramingSchema",
              "ResolvedAction",
              "CombatNarrationInputs",
              "CombatNarrationOutput",
              "CombatNarrationSchema",
              "NPCDialogueInputs",
              "NPCDialogueOutput",
              "NPCDialogueSchema",
              "FailureConsequenceInputs",
              "FailureConsequenceOutput",
              "FailureConsequenceSchema",
              "DowntimeSummaryInputs",
              "DowntimeSummaryOutput",
              "DowntimeSummarySchema",
              "CombatConclusionInputs",
              "CombatConclusionSchema",
              "DungeonEventInputs",
              "DungeonEventSchema",
              "RestExperienceInputs",
              "RestExperienceSchema",
              "POIApproachInputs",
              "POIApproachSchema",
              "POIEntryInputs",
              "POIEntrySchema",
              "POIFeatureInputs",
              "POIFeatureSchema",
              "ResolvedActionInputs",
              "ResolvedActionSchema",
              "SpellCastNarrationInputs",
              "SpellCastNarrationOutput",
              "SpellCastNarrationSchema",
              "SpellRevelationInputs",
              "SpellRevelationSchema",
              "MythicInterpretationInputs",
              "MythicInterpretationOutput",
              "MythicInterpretationSchema",
              "IntentParseInputs",
              "IntentParseOutput",
              "IntentParseSchema",
              "NarrativeIntentInputs",
              "NarrativeIntentOutput",
              "NarrativeIntentSchema"
            ],
            "functions": [
              "create_schema"
            ],
            "imports": []
          }
        ]
      },
      {
        "id": "classes",
        "file_count": 13,
        "modules": [
          {
            "path": "classes/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.ability_registry",
              "src.classes.class_data",
              "src.classes.class_manager"
            ]
          },
          {
            "path": "classes/ability_registry.py",
            "classes": [
              "AbilityEffectType",
              "AbilityIntegration",
              "AbilityRegistry"
            ],
            "functions": [
              "get_ability_registry"
            ],
            "imports": []
          },
          {
            "path": "classes/bard.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/class_data.py",
            "classes": [
              "MagicType",
              "HitDie",
              "ArmorProficiency",
              "WeaponProficiency",
              "SavingThrows",
              "LevelProgression",
              "ClassAbility",
              "ClassDefinition"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "classes/class_manager.py",
            "classes": [
              "ClassManager"
            ],
            "functions": [
              "get_class_manager"
            ],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/cleric.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/enchanter.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/fighter.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/friar.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/hunter.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/knight.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/magician.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          },
          {
            "path": "classes/thief.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.classes.class_data"
            ]
          }
        ]
      },
      {
        "id": "combat",
        "file_count": 2,
        "modules": [
          {
            "path": "combat/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.combat.combat_engine"
            ]
          },
          {
            "path": "combat/combat_engine.py",
            "classes": [
              "CombatActionType",
              "MoraleCheckTrigger",
              "MissileRange",
              "CoverType",
              "CombatAction",
              "CombatantStatus",
              "AttackModifierResult",
              "AttackResult",
              "CombatRoundResult",
              "CombatState",
              "CombatEngine"
            ],
            "functions": [],
            "imports": [
              "src.classes.ability_registry",
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine",
              "src.narrative.spell_resolver"
            ]
          }
        ]
      },
      {
        "id": "content_loader",
        "file_count": 9,
        "modules": [
          {
            "path": "content_loader/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.content_loader.content_manager",
              "src.content_loader.content_pipeline",
              "src.content_loader.hex_loader",
              "src.content_loader.monster_loader",
              "src.content_loader.monster_registry",
              "src.content_loader.pdf_parser",
              "src.content_loader.spell_loader",
              "src.content_loader.spell_registry"
            ]
          },
          {
            "path": "content_loader/content_manager.py",
            "classes": [
              "ContentType",
              "ContentEntry",
              "ConflictResolution",
              "ContentManager"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "content_loader/content_pipeline.py",
            "classes": [
              "ValidationError",
              "ExtractionError",
              "ValidationResult",
              "ImportResult",
              "BatchImportResult",
              "ContentValidator",
              "DefaultValidator",
              "ContentPipeline"
            ],
            "functions": [],
            "imports": [
              "src.content_loader.content_manager",
              "src.content_loader.pdf_parser",
              "src.data_models",
              "src.game_state.state_machine",
              "src.vector_db.rules_retriever"
            ]
          },
          {
            "path": "content_loader/hex_loader.py",
            "classes": [
              "HexFileMetadata",
              "HexFileLoadResult",
              "HexDirectoryLoadResult",
              "HexDataLoader"
            ],
            "functions": [
              "load_all_hexes",
              "create_sample_hex_json"
            ],
            "imports": [
              "src.content_loader.content_manager",
              "src.content_loader.content_pipeline",
              "src.data_models"
            ]
          },
          {
            "path": "content_loader/monster_loader.py",
            "classes": [
              "MonsterFileMetadata",
              "MonsterFileLoadResult",
              "MonsterDirectoryLoadResult",
              "MonsterDataLoader"
            ],
            "functions": [
              "load_all_monsters"
            ],
            "imports": [
              "src.content_loader.content_manager",
              "src.content_loader.content_pipeline",
              "src.data_models"
            ]
          },
          {
            "path": "content_loader/monster_registry.py",
            "classes": [
              "MonsterLookupResult",
              "StatBlockResult",
              "NPCStatRequest",
              "MonsterRegistry"
            ],
            "functions": [
              "get_monster_registry",
              "reset_monster_registry"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "content_loader/pdf_parser.py",
            "classes": [
              "BookType",
              "ParsedPage",
              "ParsedSection",
              "ParseResult",
              "PDFParser",
              "TextParser"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "content_loader/spell_loader.py",
            "classes": [
              "SpellFileMetadata",
              "SpellFileLoadResult",
              "SpellDirectoryLoadResult",
              "SpellParser",
              "SpellDataLoader"
            ],
            "functions": [
              "load_all_spells",
              "register_spells_with_resolver"
            ],
            "imports": [
              "src.narrative.intent_parser",
              "src.narrative.spell_resolver"
            ]
          },
          {
            "path": "content_loader/spell_registry.py",
            "classes": [
              "SpellLookupResult",
              "SpellListResult",
              "SpellRegistry"
            ],
            "functions": [
              "get_spell_registry",
              "reset_spell_registry"
            ],
            "imports": [
              "src.narrative.spell_resolver"
            ]
          }
        ]
      },
      {
        "id": "conversation",
        "file_count": 7,
        "modules": [
          {
            "path": "conversation/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.conversation.conversation_facade",
              "src.conversation.state_export",
              "src.conversation.suggestion_builder",
              "src.conversation.types"
            ]
          },
          {
            "path": "conversation/action_registry.py",
            "classes": [
              "ActionCategory",
              "ActionSpec",
              "ActionRegistry"
            ],
            "functions": [
              "_create_default_registry",
              "get_default_registry",
              "reset_registry"
            ],
            "imports": []
          },
          {
            "path": "conversation/conversation_facade.py",
            "classes": [
              "ConversationConfig",
              "ConversationFacade"
            ],
            "functions": [],
            "imports": [
              "src.conversation.state_export",
              "src.conversation.suggestion_builder",
              "src.conversation.types",
              "src.data_models",
              "src.dungeon.dungeon_engine",
              "src.encounter.encounter_engine",
              "src.game_state.state_machine",
              "src.oracle.mythic_gme"
            ]
          },
          {
            "path": "conversation/oracle_enhancement.py",
            "classes": [
              "AmbiguityType",
              "AmbiguityDetection",
              "OracleResolution",
              "OracleEnhancement"
            ],
            "functions": [
              "create_oracle_enhancement"
            ],
            "imports": [
              "src.oracle.mythic_gme"
            ]
          },
          {
            "path": "conversation/state_export.py",
            "classes": [
              "EventStream"
            ],
            "functions": [
              "export_public_state"
            ],
            "imports": [
              "src.observability.run_log"
            ]
          },
          {
            "path": "conversation/suggestion_builder.py",
            "classes": [
              "_Candidate"
            ],
            "functions": [
              "_clamp",
              "_default_character_id",
              "_current_hex_id",
              "_has_light",
              "build_suggestions",
              "_dungeon_suggestions",
              "_wilderness_suggestions",
              "_encounter_suggestions",
              "_settlement_suggestions",
              "_downtime_suggestions",
              "_oracle_suggestions"
            ],
            "imports": [
              "src.conversation.types",
              "src.dungeon.dungeon_engine",
              "src.encounter.encounter_engine",
              "src.game_state.state_machine"
            ]
          },
          {
            "path": "conversation/types.py",
            "classes": [
              "ChatMessage",
              "SuggestedAction",
              "TurnResponse"
            ],
            "functions": [],
            "imports": []
          }
        ]
      },
      {
        "id": "downtime",
        "file_count": 2,
        "modules": [
          {
            "path": "downtime/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.downtime.downtime_engine"
            ]
          },
          {
            "path": "downtime/downtime_engine.py",
            "classes": [
              "DowntimeActivity",
              "RestType",
              "SleepDifficulty",
              "BeddingType",
              "CampState",
              "FactionStanding",
              "FactionRelation",
              "DowntimeResult",
              "TrainingProgress",
              "DowntimeEngine"
            ],
            "functions": [],
            "imports": [
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine"
            ]
          }
        ]
      },
      {
        "id": "dungeon",
        "file_count": 2,
        "modules": [
          {
            "path": "dungeon/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.dungeon.dungeon_engine"
            ]
          },
          {
            "path": "dungeon/dungeon_engine.py",
            "classes": [
              "DungeonActionType",
              "DungeonDoomResult",
              "DoorState",
              "LightLevel",
              "DungeonRoom",
              "DungeonTurnResult",
              "DungeonState",
              "DungeonEngine"
            ],
            "functions": [],
            "imports": [
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine"
            ]
          }
        ]
      },
      {
        "id": "encounter",
        "file_count": 3,
        "modules": [
          {
            "path": "encounter/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.encounter.encounter_engine",
              "src.encounter.encounter_factory"
            ]
          },
          {
            "path": "encounter/encounter_engine.py",
            "classes": [
              "EncounterPhase",
              "EncounterOrigin",
              "EncounterAction",
              "AwarenessResult",
              "SurpriseResult",
              "DistanceResult",
              "InitiativeResult",
              "ActionDeclaration",
              "EncounterRoundResult",
              "EncounterEngineState",
              "EncounterEngine"
            ],
            "functions": [],
            "imports": [
              "src.classes.ability_registry",
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine"
            ]
          },
          {
            "path": "encounter/encounter_factory.py",
            "classes": [
              "EncounterFactoryResult",
              "EncounterFactory"
            ],
            "functions": [
              "get_encounter_factory",
              "reset_encounter_factory",
              "create_encounter_from_roll",
              "create_wilderness_encounter",
              "start_wilderness_encounter",
              "start_dungeon_encounter",
              "start_settlement_encounter"
            ],
            "imports": [
              "src.content_loader.monster_registry",
              "src.data_models",
              "src.npc.encounter_npc_generator",
              "src.tables.encounter_roller"
            ]
          }
        ]
      },
      {
        "id": "game_state",
        "file_count": 4,
        "modules": [
          {
            "path": "game_state/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.game_state.global_controller",
              "src.game_state.session_manager",
              "src.game_state.state_machine"
            ]
          },
          {
            "path": "game_state/global_controller.py",
            "classes": [
              "TimeTracker",
              "GlobalController"
            ],
            "functions": [],
            "imports": [
              "src.data_models",
              "src.game_state.state_machine",
              "src.oracle.spell_adjudicator"
            ]
          },
          {
            "path": "game_state/session_manager.py",
            "classes": [
              "POIStateDelta",
              "NPCStateDelta",
              "HexStateDelta",
              "SerializableCharacter",
              "SerializablePartyState",
              "SerializableWorldState",
              "SerializableScheduledEvent",
              "SerializableGrantedAbility",
              "SerializableWorldChange",
              "GameSession",
              "SessionManager"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "game_state/state_machine.py",
            "classes": [
              "GameState",
              "StateTransition",
              "InvalidTransitionError",
              "StateMachine"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          }
        ]
      },
      {
        "id": "hex_crawl",
        "file_count": 2,
        "modules": [
          {
            "path": "hex_crawl/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.hex_crawl.hex_crawl_engine"
            ]
          },
          {
            "path": "hex_crawl/hex_crawl_engine.py",
            "classes": [
              "POIExplorationState",
              "POIVisit",
              "SecretCheck",
              "HexMagicalEffects",
              "HexOverview",
              "RouteType",
              "TerrainInfo",
              "TravelSegmentResult",
              "TravelDayState",
              "HexCrawlEngine"
            ],
            "functions": [],
            "imports": [
              "src.content_loader.monster_registry",
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine"
            ]
          }
        ]
      },
      {
        "id": "integrations",
        "file_count": 2,
        "modules": [
          {
            "path": "integrations/foundry/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.integrations.foundry.foundry_bridge"
            ]
          },
          {
            "path": "integrations/foundry/foundry_bridge.py",
            "classes": [
              "FoundryExportMode",
              "FoundryEventType",
              "FoundryEvent",
              "FoundryStateExport",
              "FoundryBridge"
            ],
            "functions": [],
            "imports": []
          }
        ]
      },
      {
        "id": "items",
        "file_count": 3,
        "modules": [
          {
            "path": "items/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.items.item_catalog",
              "src.items.item_materializer"
            ]
          },
          {
            "path": "items/item_catalog.py",
            "classes": [
              "ItemCatalog"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "items/item_materializer.py",
            "classes": [
              "ItemMaterializer"
            ],
            "functions": [],
            "imports": [
              "src.data_models"
            ]
          }
        ]
      },
      {
        "id": "kindred",
        "file_count": 10,
        "modules": [
          {
            "path": "kindred/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data",
              "src.kindred.kindred_generator",
              "src.kindred.kindred_manager"
            ]
          },
          {
            "path": "kindred/breggle.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/elf.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/grimalkin.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/human.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/kindred_data.py",
            "classes": [
              "KindredType",
              "AspectType",
              "NameColumn",
              "DiceFormula",
              "PhysicalRanges",
              "KindredAbility",
              "AspectTableEntry",
              "AspectTable",
              "NameTable",
              "LevelProgression",
              "KindredDefinition",
              "GeneratedKindredAspects"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "kindred/kindred_generator.py",
            "classes": [
              "KindredGenerator"
            ],
            "functions": [
              "roll_dice",
              "generate_character_kindred",
              "generate_npc_kindred"
            ],
            "imports": [
              "src.data_models",
              "src.kindred.kindred_data",
              "src.kindred.kindred_manager"
            ]
          },
          {
            "path": "kindred/kindred_manager.py",
            "classes": [
              "KindredManager"
            ],
            "functions": [
              "get_kindred_manager"
            ],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/mossling.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          },
          {
            "path": "kindred/woodgrue.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.kindred.kindred_data"
            ]
          }
        ]
      },
      {
        "id": "narrative",
        "file_count": 8,
        "modules": [
          {
            "path": "narrative/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.narrative.creative_resolver",
              "src.narrative.hazard_resolver",
              "src.narrative.intent_parser",
              "src.narrative.narrative_resolver",
              "src.narrative.spell_resolver"
            ]
          },
          {
            "path": "narrative/creative_resolver.py",
            "classes": [
              "CreativeSolutionCategory",
              "CreativeSolution",
              "CreativeResolutionResult",
              "CreativeSolutionResolver"
            ],
            "functions": [],
            "imports": [
              "src.narrative.intent_parser"
            ]
          },
          {
            "path": "narrative/hazard_resolver.py",
            "classes": [
              "HazardType",
              "DarknessLevel",
              "HazardResult",
              "DivingState",
              "HazardResolver"
            ],
            "functions": [],
            "imports": [
              "src.narrative.intent_parser",
              "src.narrative.sensory_details",
              "src.tables.fishing_tables",
              "src.tables.foraging_tables",
              "src.tables.hunting_tables"
            ]
          },
          {
            "path": "narrative/intent_parser.py",
            "classes": [
              "ActionCategory",
              "ActionType",
              "ResolutionType",
              "CheckType",
              "SaveType",
              "ParsedIntent",
              "IntentParserConfig"
            ],
            "functions": [
              "get_hazard_rule",
              "is_adventurer_competency"
            ],
            "imports": []
          },
          {
            "path": "narrative/narrative_resolver.py",
            "classes": [
              "NarrationContext",
              "ResolutionResult",
              "NarrativeResolver"
            ],
            "functions": [],
            "imports": [
              "src.narrative.creative_resolver",
              "src.narrative.hazard_resolver",
              "src.narrative.intent_parser",
              "src.narrative.spell_resolver"
            ]
          },
          {
            "path": "narrative/sensory_details.py",
            "classes": [
              "TimeOfDayContext",
              "WeatherContext",
              "TerrainContext",
              "SensoryContext"
            ],
            "functions": [
              "get_foraging_scene",
              "get_fishing_scene",
              "get_hunting_scene",
              "get_trap_scene",
              "get_secret_door_scene",
              "build_narrative_hints"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "narrative/spell_context.py",
            "classes": [
              "RevelationType",
              "Revelation",
              "SpellRevelation",
              "WrittenText",
              "ItemHistory",
              "CreatureHistory",
              "HistoryGenerator",
              "SpellContextProvider",
              "DetectMagicProvider",
              "DetectEvilProvider",
              "WoodKenningProvider",
              "CrystalResonanceProvider",
              "DecipherProvider",
              "SpellContextRegistry"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "narrative/spell_resolver.py",
            "classes": [
              "DurationType",
              "RangeType",
              "SpellEffectType",
              "MagicType",
              "RuneMagnitude",
              "UsageFrequency",
              "MechanicalEffectCategory",
              "MechanicalEffect",
              "ParsedMechanicalEffects",
              "SpellComponent",
              "LevelScalingType",
              "LevelScaling",
              "GlamourUsageRecord",
              "RuneUsageState",
              "SaveResult",
              "SpellData",
              "ActiveSpellEffect",
              "SpellCastResult",
              "SpellResolver",
              "SpellNarrator"
            ],
            "functions": [],
            "imports": [
              "src.narrative.intent_parser"
            ]
          }
        ]
      },
      {
        "id": "npc",
        "file_count": 6,
        "modules": [
          {
            "path": "npc/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.npc.npc_generator"
            ]
          },
          {
            "path": "npc/adventurer_data.py",
            "classes": [],
            "functions": [
              "get_adventurer_template",
              "get_all_class_ids",
              "get_template_levels"
            ],
            "imports": []
          },
          {
            "path": "npc/adventurer_tables.py",
            "classes": [],
            "functions": [
              "get_class_for_kindred",
              "get_quest_table",
              "is_spell_caster",
              "get_magic_item_chance",
              "get_available_classes_for_kindred",
              "get_all_kindreds"
            ],
            "imports": []
          },
          {
            "path": "npc/encounter_npc_generator.py",
            "classes": [
              "EverydayMortalResult",
              "AdventurerResult",
              "AdventuringPartyResult",
              "EncounterNPCGenerator"
            ],
            "functions": [
              "get_encounter_npc_generator"
            ],
            "imports": [
              "src.data_models",
              "src.npc.adventurer_data",
              "src.npc.adventurer_tables",
              "src.npc.everyday_mortal_data"
            ]
          },
          {
            "path": "npc/everyday_mortal_data.py",
            "classes": [
              "EverydayMortalType"
            ],
            "functions": [
              "get_mortal_type",
              "get_all_mortal_types"
            ],
            "imports": []
          },
          {
            "path": "npc/npc_generator.py",
            "classes": [
              "AbilityScoreMethod",
              "NPCGenerationResult",
              "NPCGenerator"
            ],
            "functions": [],
            "imports": [
              "src.classes.class_data",
              "src.classes.class_manager",
              "src.data_models",
              "src.kindred.kindred_data",
              "src.kindred.kindred_manager"
            ]
          }
        ]
      },
      {
        "id": "observability",
        "file_count": 3,
        "modules": [
          {
            "path": "observability/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.observability.replay",
              "src.observability.run_log"
            ]
          },
          {
            "path": "observability/replay.py",
            "classes": [
              "ReplayMode",
              "ReplaySession"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "observability/run_log.py",
            "classes": [
              "EventType",
              "LogEvent",
              "RollEvent",
              "TransitionEvent",
              "TableLookupEvent",
              "TimeStepEvent",
              "RunLog"
            ],
            "functions": [
              "get_run_log",
              "reset_run_log"
            ],
            "imports": []
          }
        ]
      },
      {
        "id": "oracle",
        "file_count": 4,
        "modules": [
          {
            "path": "oracle/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.oracle.effect_commands",
              "src.oracle.mythic_gme",
              "src.oracle.spell_adjudicator"
            ]
          },
          {
            "path": "oracle/effect_commands.py",
            "classes": [
              "EffectType",
              "EffectCommand",
              "EffectResult",
              "EffectBatch",
              "EffectCommandBuilder",
              "EffectValidator",
              "EffectExecutor"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "oracle/mythic_gme.py",
            "classes": [
              "Likelihood",
              "FateResult",
              "RandomEventFocus",
              "FateCheckResult",
              "RandomEvent",
              "MeaningRoll",
              "ChaosFactorState",
              "MythicGME"
            ],
            "functions": [],
            "imports": []
          },
          {
            "path": "oracle/spell_adjudicator.py",
            "classes": [
              "SpellAdjudicationType",
              "SuccessLevel",
              "AdjudicationContext",
              "AdjudicationResult",
              "MythicSpellAdjudicator"
            ],
            "functions": [],
            "imports": [
              "src.oracle.mythic_gme"
            ]
          }
        ]
      },
      {
        "id": "resolution",
        "file_count": 2,
        "modules": [
          {
            "path": "resolution/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.resolution.skill_resolver"
            ]
          },
          {
            "path": "resolution/skill_resolver.py",
            "classes": [
              "SkillOutcome",
              "SkillCheckResult",
              "SkillDefinition",
              "SkillResolver"
            ],
            "functions": [
              "get_skill_resolver",
              "resolve_skill_check"
            ],
            "imports": [
              "src.data_models"
            ]
          }
        ]
      },
      {
        "id": "root",
        "file_count": 3,
        "modules": [
          {
            "path": "__init__.py",
            "classes": [],
            "functions": [],
            "imports": []
          },
          {
            "path": "data_models.py",
            "classes": [
              "Season",
              "Weather",
              "LocationType",
              "TerrainType",
              "EncounterType",
              "SurpriseStatus",
              "ReactionResult",
              "ConditionType",
              "ConfusionBehavior",
              "VisibilityState",
              "FlightState",
              "LocationFamiliarity",
              "BarrierType",
              "LightSourceType",
              "TimeOfDay",
              "WatchPeriod",
              "MovementMode",
              "SourceType",
              "CombatPhase",
              "ActionType",
              "DiceRoller",
              "DiceResult",
              "MoonPhase",
              "DolmenwoodMonth",
              "GameDate",
              "GameTime",
              "EncumbranceSystem",
              "ArmorWeight",
              "GearSlotType",
              "RunningState",
              "MovementCalculator",
              "EncumbranceCalculator",
              "EncumbranceState",
              "Condition",
              "StatModifier",
              "Item",
              "Spell",
              "StatBlock",
              "MonsterSaves",
              "Monster",
              "HexFeature",
              "HexProcedural",
              "RollTableEntry",
              "RollTable",
              "PointOfInterest",
              "HexStateChange",
              "WorldStateChanges",
              "EventType",
              "ScheduledEvent",
              "EventScheduler",
              "AbilityType",
              "GrantedAbility",
              "AbilityGrantTracker",
              "HexNPC",
              "Feature",
              "Hazard",
              "Lair",
              "Landmark",
              "Threat",
              "WorldState",
              "PartyResources",
              "Location",
              "PartyState",
              "SpellSlotState",
              "AnimalCompanion",
              "HunterTrophy",
              "ClassSpecificData",
              "CharacterState",
              "AreaEffectType",
              "AreaEffect",
              "BarrierEffect",
              "CompulsionState",
              "GlyphType",
              "Glyph",
              "PolymorphOverlay",
              "LocationState",
              "Combatant",
              "EncounterState",
              "SocialOrigin",
              "SocialParticipantType",
              "TopicRelevance",
              "SecretStatus",
              "KnownTopic",
              "SecretInfo",
              "ConversationTracker",
              "SocialParticipant",
              "SocialContext",
              "SourceReference",
              "ContentSource",
              "NPC",
              "HexLocation",
              "ActionResult",
              "TransitionLog"
            ],
            "functions": [
              "interpret_reaction",
              "get_dolmenwood_year_length"
            ],
            "imports": []
          },
          {
            "path": "main.py",
            "classes": [
              "GameConfig",
              "VirtualDM",
              "DolmenwoodCLI"
            ],
            "functions": [
              "setup_logging",
              "create_demo_session",
              "test_hex_exploration_loop",
              "test_encounter_loop",
              "test_dungeon_exploration_loop",
              "test_combat_loop",
              "test_settlement_loop",
              "test_social_interaction_loop",
              "parse_arguments",
              "create_config_from_args",
              "main"
            ],
            "imports": [
              "src.ai",
              "src.ai.lore_search",
              "src.combat",
              "src.conversation",
              "src.data_models",
              "src.downtime",
              "src.dungeon",
              "src.encounter",
              "src.game_state",
              "src.hex_crawl",
              "src.narrative",
              "src.narrative.intent_parser",
              "src.settlement"
            ]
          }
        ]
      },
      {
        "id": "settlement",
        "file_count": 2,
        "modules": [
          {
            "path": "settlement/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.settlement.settlement_engine"
            ]
          },
          {
            "path": "settlement/settlement_engine.py",
            "classes": [
              "SettlementSize",
              "LifestyleType",
              "ServiceType",
              "BuildingType",
              "ConversationTopic",
              "Building",
              "Settlement",
              "ConversationState",
              "SettlementEngine"
            ],
            "functions": [],
            "imports": [
              "src.data_models",
              "src.game_state.global_controller",
              "src.game_state.state_machine"
            ]
          }
        ]
      },
      {
        "id": "tables",
        "file_count": 16,
        "modules": [
          {
            "path": "tables/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.tables.action_resolver",
              "src.tables.character_tables",
              "src.tables.dolmenwood_tables",
              "src.tables.encounter_tables",
              "src.tables.table_manager",
              "src.tables.table_types",
              "src.tables.treasure_tables"
            ]
          },
          {
            "path": "tables/action_resolver.py",
            "classes": [
              "ResolutionType",
              "FailureSeverity",
              "FailureConsequence",
              "SuccessEffect",
              "ActionContext",
              "ActionResolution",
              "ActionResolver"
            ],
            "functions": [
              "prepare_skill_check",
              "quick_skill_check"
            ],
            "imports": [
              "src.data_models",
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/character_tables.py",
            "classes": [
              "CharacterTableManager"
            ],
            "functions": [
              "get_character_table_manager"
            ],
            "imports": [
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/dolmenwood_tables.py",
            "classes": [
              "DolmenwoodTables"
            ],
            "functions": [
              "get_dolmenwood_tables"
            ],
            "imports": [
              "src.tables.table_manager",
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/encounter_roller.py",
            "classes": [
              "EncounterEntryType",
              "RolledEncounter",
              "EncounterContext",
              "LairCheckResult",
              "EncounterRoller"
            ],
            "functions": [
              "_roll_number_appearing",
              "get_encounter_roller",
              "roll_wilderness_encounter"
            ],
            "imports": [
              "src.data_models",
              "src.tables.wilderness_encounter_tables"
            ]
          },
          {
            "path": "tables/encounter_tables.py",
            "classes": [
              "EncounterTableManager"
            ],
            "functions": [
              "get_encounter_table_manager"
            ],
            "imports": [
              "src.data_models",
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/fishing_tables.py",
            "classes": [
              "FishEffectType",
              "LandingType",
              "LandingRequirement",
              "CatchEffect",
              "CatchableFish"
            ],
            "functions": [
              "roll_fish",
              "roll_fish_rations",
              "get_fish_by_name",
              "get_all_fish",
              "check_treasure_in_fish",
              "check_first_timer_danger",
              "check_monster_attracted",
              "fish_requires_landing_check",
              "fish_triggers_combat",
              "fish_is_fairy",
              "fish_to_inventory_item"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "tables/foraging_tables.py",
            "classes": [
              "ForageType",
              "EffectType",
              "ConsumptionEffect",
              "ForageableItem"
            ],
            "functions": [
              "roll_forage_type",
              "roll_foraged_item",
              "roll_forage_quantity",
              "get_foraged_item_by_name",
              "get_all_fungi",
              "get_all_plants",
              "is_fungi",
              "forageable_to_inventory_item"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "tables/hunting_tables.py",
            "classes": [
              "TerrainType",
              "AnimalSize",
              "GameAnimal"
            ],
            "functions": [
              "get_game_animal",
              "get_game_animal_by_name",
              "roll_game_animal",
              "roll_number_appearing",
              "roll_encounter_distance",
              "calculate_rations_yield",
              "get_hunting_terrain",
              "get_all_animals",
              "get_animals_in_terrain",
              "animal_appears_in_terrain",
              "hunting_to_rations_item"
            ],
            "imports": []
          },
          {
            "path": "tables/procedure_triggers.py",
            "classes": [],
            "functions": [],
            "imports": []
          },
          {
            "path": "tables/secret_door_tables.py",
            "classes": [
              "SecretDoorType",
              "MechanismType",
              "SecretDoorLocation",
              "MechanicalMechanism",
              "MagicalMechanism",
              "ClueType",
              "PortalType",
              "SecretDoor",
              "SecretDoorInteraction"
            ],
            "functions": [
              "roll_secret_door_type",
              "roll_location",
              "roll_mechanism_type",
              "roll_mechanical_mechanism",
              "roll_magical_mechanism",
              "generate_clues",
              "generate_secret_door",
              "_generate_password",
              "_generate_riddle_answer",
              "attempt_open_mechanism",
              "search_for_secret_door"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "tables/table_manager.py",
            "classes": [
              "TableManager"
            ],
            "functions": [
              "get_table_manager"
            ],
            "imports": [
              "src.data_models",
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/table_types.py",
            "classes": [
              "Kindred",
              "NameColumn",
              "CharacterAspectType",
              "EncounterLocationType",
              "EncounterTimeOfDay",
              "EncounterSeason",
              "DolmenwoodRegion",
              "DolmenwoodSettlement",
              "EncounterResultType",
              "TableCategory",
              "DieType",
              "TableEntry",
              "DolmenwoodTable",
              "TableResult",
              "TableContext",
              "SkillCheck",
              "SkillTarget",
              "NameTableColumn",
              "KindredNameTable",
              "CharacterAspectTable",
              "CharacterAspectResult",
              "GeneratedCharacterAspects",
              "EncounterTableCategory",
              "NestedTableConditionType",
              "NestedTableCondition",
              "EncounterTableContext",
              "EncounterEntry",
              "NestedTableSelector",
              "EncounterTable",
              "EncounterResult",
              "TreasureTableCategory",
              "TreasureType",
              "CoinType",
              "MagicItemCategory",
              "TreasureEntry",
              "TreasureTableContext",
              "TreasureNestedTableSelector",
              "TreasureTable",
              "TreasureComponent",
              "GeneratedTreasureItem",
              "TreasureResult",
              "RollTableType",
              "RollTableEntry",
              "RollTableMetadata",
              "RollTable",
              "RollTableReference",
              "RollResult",
              "HexTableCategory",
              "HexRollTableEntry",
              "HexRollTable"
            ],
            "functions": [
              "_infer_hex_table_category",
              "parse_hex_roll_tables",
              "convert_hex_tables_to_roll_tables"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "tables/trap_tables.py",
            "classes": [
              "TrapCategory",
              "TrapTrigger",
              "TrapEffectType",
              "TrapEffect",
              "Trap",
              "DisarmAttempt"
            ],
            "functions": [
              "generate_random_trap",
              "get_trap_by_effect",
              "get_exploration_clues",
              "get_bypass_options",
              "can_attempt_disarm",
              "attempt_disarm"
            ],
            "imports": [
              "src.data_models"
            ]
          },
          {
            "path": "tables/treasure_tables.py",
            "classes": [
              "TreasureTableManager"
            ],
            "functions": [
              "get_treasure_table_manager"
            ],
            "imports": [
              "src.data_models",
              "src.tables.table_types"
            ]
          },
          {
            "path": "tables/wilderness_encounter_tables.py",
            "classes": [
              "TimeOfDay",
              "LocationType",
              "EncounterCategory",
              "EncounterEntry"
            ],
            "functions": [
              "E",
              "get_encounter_type_table",
              "get_common_table",
              "get_regional_table",
              "get_unseason_table",
              "get_all_regions"
            ],
            "imports": []
          }
        ]
      },
      {
        "id": "vector_db",
        "file_count": 2,
        "modules": [
          {
            "path": "vector_db/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.vector_db.rules_retriever"
            ]
          },
          {
            "path": "vector_db/rules_retriever.py",
            "classes": [
              "ContentCategory",
              "SearchResult",
              "SearchContext",
              "IndexedDocument",
              "RulesRetriever"
            ],
            "functions": [],
            "imports": [
              "src.data_models",
              "src.game_state.state_machine"
            ]
          }
        ]
      },
      {
        "id": "weather",
        "file_count": 4,
        "modules": [
          {
            "path": "weather/__init__.py",
            "classes": [],
            "functions": [],
            "imports": [
              "src.weather.calendar",
              "src.weather.unseason_tracker",
              "src.weather.weather_types"
            ]
          },
          {
            "path": "weather/calendar.py",
            "classes": [
              "DolmenwoodSeason",
              "Unseason",
              "DolmenwoodMonth"
            ],
            "functions": [
              "get_season_for_month",
              "get_daylight_hours",
              "get_month_by_name",
              "get_year_length",
              "is_dolmenday"
            ],
            "imports": []
          },
          {
            "path": "weather/unseason_tracker.py",
            "classes": [
              "UnseasonState"
            ],
            "functions": [
              "check_unseason_trigger",
              "get_active_unseason_effects"
            ],
            "imports": [
              "src.data_models",
              "src.weather.calendar"
            ]
          },
          {
            "path": "weather/weather_types.py",
            "classes": [
              "WeatherEffect",
              "WeatherEntry",
              "WeatherResult"
            ],
            "functions": [
              "get_weather_table_for_month",
              "roll_weather",
              "get_effect_description"
            ],
            "imports": [
              "src.data_models",
              "src.weather.calendar"
            ]
          }
        ]
      }
    ],
    "package_dependency_edges": [
      {
        "from": "advancement",
        "to": "game_state"
      },
      {
        "from": "advancement",
        "to": "root"
      },
      {
        "from": "ai",
        "to": "root"
      },
      {
        "from": "ai",
        "to": "vector_db"
      },
      {
        "from": "classes",
        "to": "root"
      },
      {
        "from": "combat",
        "to": "classes"
      },
      {
        "from": "combat",
        "to": "game_state"
      },
      {
        "from": "combat",
        "to": "narrative"
      },
      {
        "from": "combat",
        "to": "root"
      },
      {
        "from": "content_loader",
        "to": "game_state"
      },
      {
        "from": "content_loader",
        "to": "narrative"
      },
      {
        "from": "content_loader",
        "to": "npc"
      },
      {
        "from": "content_loader",
        "to": "root"
      },
      {
        "from": "content_loader",
        "to": "vector_db"
      },
      {
        "from": "conversation",
        "to": "dungeon"
      },
      {
        "from": "conversation",
        "to": "encounter"
      },
      {
        "from": "conversation",
        "to": "game_state"
      },
      {
        "from": "conversation",
        "to": "observability"
      },
      {
        "from": "conversation",
        "to": "oracle"
      },
      {
        "from": "conversation",
        "to": "root"
      },
      {
        "from": "downtime",
        "to": "game_state"
      },
      {
        "from": "downtime",
        "to": "root"
      },
      {
        "from": "dungeon",
        "to": "game_state"
      },
      {
        "from": "dungeon",
        "to": "narrative"
      },
      {
        "from": "dungeon",
        "to": "root"
      },
      {
        "from": "dungeon",
        "to": "tables"
      },
      {
        "from": "encounter",
        "to": "classes"
      },
      {
        "from": "encounter",
        "to": "content_loader"
      },
      {
        "from": "encounter",
        "to": "game_state"
      },
      {
        "from": "encounter",
        "to": "npc"
      },
      {
        "from": "encounter",
        "to": "root"
      },
      {
        "from": "encounter",
        "to": "tables"
      },
      {
        "from": "game_state",
        "to": "combat"
      },
      {
        "from": "game_state",
        "to": "hex_crawl"
      },
      {
        "from": "game_state",
        "to": "observability"
      },
      {
        "from": "game_state",
        "to": "oracle"
      },
      {
        "from": "game_state",
        "to": "root"
      },
      {
        "from": "hex_crawl",
        "to": "content_loader"
      },
      {
        "from": "hex_crawl",
        "to": "game_state"
      },
      {
        "from": "hex_crawl",
        "to": "narrative"
      },
      {
        "from": "hex_crawl",
        "to": "root"
      },
      {
        "from": "hex_crawl",
        "to": "tables"
      },
      {
        "from": "integrations",
        "to": "root"
      },
      {
        "from": "items",
        "to": "root"
      },
      {
        "from": "items",
        "to": "tables"
      },
      {
        "from": "kindred",
        "to": "root"
      },
      {
        "from": "narrative",
        "to": "ai"
      },
      {
        "from": "narrative",
        "to": "classes"
      },
      {
        "from": "narrative",
        "to": "game_state"
      },
      {
        "from": "narrative",
        "to": "root"
      },
      {
        "from": "narrative",
        "to": "tables"
      },
      {
        "from": "npc",
        "to": "classes"
      },
      {
        "from": "npc",
        "to": "kindred"
      },
      {
        "from": "npc",
        "to": "root"
      },
      {
        "from": "oracle",
        "to": "game_state"
      },
      {
        "from": "oracle",
        "to": "root"
      },
      {
        "from": "resolution",
        "to": "classes"
      },
      {
        "from": "resolution",
        "to": "root"
      },
      {
        "from": "root",
        "to": "ai"
      },
      {
        "from": "root",
        "to": "combat"
      },
      {
        "from": "root",
        "to": "conversation"
      },
      {
        "from": "root",
        "to": "downtime"
      },
      {
        "from": "root",
        "to": "encounter"
      },
      {
        "from": "root",
        "to": "narrative"
      },
      {
        "from": "root",
        "to": "observability"
      },
      {
        "from": "root",
        "to": "tables"
      },
      {
        "from": "settlement",
        "to": "game_state"
      },
      {
        "from": "settlement",
        "to": "root"
      },
      {
        "from": "tables",
        "to": "content_loader"
      },
      {
        "from": "tables",
        "to": "npc"
      },
      {
        "from": "tables",
        "to": "observability"
      },
      {
        "from": "tables",
        "to": "root"
      },
      {
        "from": "vector_db",
        "to": "game_state"
      },
      {
        "from": "vector_db",
        "to": "root"
      },
      {
        "from": "weather",
        "to": "root"
      },
      {
        "from": "weather",
        "to": "tables"
      }
    ]
  },
  "data": {
    "content_roots": [
      "data/content/hexes",
      "data/content/spells",
      "data/content/monsters",
      "data/content/items"
    ],
    "save_files": "<save_dir>/slot_{1-9}.json",
    "docs": "docs/*.md (design and gap assessments; spells, narration, conditions)"
  }
}
